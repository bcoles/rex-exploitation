require 'rex/exploitation/js'

RSpec.describe Rex::Exploitation::Js::Memory do

  context "Class methods" do

    context ".mstime_malloc" do
      it "should load the mstime_malloc javascript" do
        js = Rex::Exploitation::Js::Memory.mstime_malloc
        expect(js).to match /function mstime_malloc/
      end
    end

    context ".heaplib2" do
      it "should load the heaplib2 javascript" do
        js = Rex::Exploitation::Js::Memory.heaplib2.to_s
        expect(js).to match /function /
      end

      it "should load the heaplib2 javascript with custom javascript" do
        js = Rex::Exploitation::Js::Memory.heaplib2(";var test = 123;").to_s
        expect(js).to match /function /
      end
    end

    context ".property_spray" do
      it "should load the property_spray javascript" do
        js = Rex::Exploitation::Js::Memory.property_spray
        expect(js).to match /function sprayHeap/
      end
    end

    context ".heap_spray" do
      it "should load the heap_spray javascript" do
        js = Rex::Exploitation::Js::Memory.heap_spray
        expect(js).to match /function sprayHeap/
      end
    end

    context ".explib2" do
      it "should load the explib2 javascript" do
        js = Rex::Exploitation::Js::Memory.explib2
        expect(js).to match /function ExpLib/
      end
    end

    context ".explib2_payload" do
      it "should load the explib2 exec payload javascript" do
        js = Rex::Exploitation::Js::Memory.explib2_payload('exec')
        expect(js).to match /function payload_exec/
      end

      it "should load the explib2 drop_exec payload javascript" do
        js = Rex::Exploitation::Js::Memory.explib2_payload('drop_exec')
        expect(js).to match /function payload_drop_exec/
      end
    end

  end

end
