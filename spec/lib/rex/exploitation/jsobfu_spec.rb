require 'spec_helper'
require 'rex/exploitation/jsobfu'

RSpec.describe Rex::Exploitation::JSObfu do
  TEST_JS = %Q|
    var test = 123;

    function x() {
      alert('1');
    };

    x();
  |

  subject(:jsobfu) do
    described_class.new(TEST_JS)
  end

  describe '#obfuscate' do
    it 'returns a #to_s object' do
      expect(jsobfu.obfuscate.to_s).to be_a(String)
    end

    it 'returns a non-empty String' do
      expect(jsobfu.obfuscate.to_s).not_to be_empty
    end
  end

  describe '#sym' do
    it 'returns an obfuscated JavaScript variable name' do
      result = jsobfu.obfuscate
      expect(result.sym('test')).not_to be_empty
      expect(result.sym('test')).to be_a(String)
    end
  end

end
