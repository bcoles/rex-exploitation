# -*- coding:binary -*-
require 'spec_helper'

require 'rex/exploitation/cmdstager'

RSpec.describe Rex::Exploitation::CmdStagerBase do

  let(:exe) { "MZ" }

  subject(:cmd_stager) do
    described_class.new(exe)
  end

  describe '#cmd_concat_operator' do
    it "returns nil" do
      expect(cmd_stager.cmd_concat_operator).to be_nil
    end
  end

  describe '#generate' do
    it "returns an empty array" do
      expect(cmd_stager.generate).to eq([])
    end
  end

  describe '#compress_commands' do
    it "raises when cmd length exceeds :linemax" do
      expect {
        cmd_stager.compress_commands(
          ["#{Rex::Text.rand_text_alphanumeric(10)}"],
          concat_operator: ';',
          linemax: 5
        )
      }.to raise_error(RuntimeError)
    end
  end

end
